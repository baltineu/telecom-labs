# Содержание:
>[Схема сетей и статические маршруты](#схема-сетей-и-статические-маршруты)

>[Настройка RIP и немного теории](#настройка-rip-и-немного-теории)

>[Сервер DHCP, DNS и почты](#сервер-dhcp-dns-и-почты)

>[Access lists (списки доступа)](#access-lists-списки-доступа)

>[Дополнительное задание](#дополнительное-задание)

# Схема сетей и статические маршруты
![Топология](https://github.com/baltineu/telecom-labs/blob/main/cisco_pt/ccna_openedu/sources/topology5.PNG)

Почти все компьютеры в топологии находятся в большой сети ```192.168.1.0/27```, которая объединяет в себе четыре сети с маской /29, из которых три реализованы в данной топологии:

| Сеть | Маска | Двоичное представление (только последний октет)|
| :- | :- | :- |
|Имеющиеся сети:|||
|192.168.1.0|/29|192.168.1.000 00 000|
|192.168.1.8|/29|192.168.1.000 01 000|
|192.168.1.16|/29|192.168.1.000 10 000|
|Резерв:|||
|192.168.1.24|/29|192.168.1.000 11 000|
|Суммарная сеть:|||
|**192.168.1.0**|**/27**|**192.168.1.000 00000**|
|Другие сети (за Router4 справа):|||
|192.168.1.32|/27|192.168.1.001 00000|
|192.168.1.64|/27|192.168.1.010 00000|

По таблице видно, каким образом три сети /29 входят в одну /27. 
В левую часть топологии к роутерам 1-4 можно подключить ещё одну сеть - 192.168.1.24/29.

Роутеры 0,1,2,3 обмениваются информацией о сетях по протоколу RIP.
На роутерах 2, 4 необходимо настроить статическую маршрутизацию между сетями 192.168.1.0/27 с одной стороны и 192.168.1.32/27 и 192.168.1.64/27 с другой.

![Статика1](https://github.com/baltineu/telecom-labs/blob/main/cisco_pt/ccna_openedu/sources/lab5/1.PNG)

![Статика2](https://github.com/baltineu/telecom-labs/blob/main/cisco_pt/ccna_openedu/sources/lab5/2.PNG)

Используется маска 255.255.255.224 (/27), полученная из двоичного представления (11100000 = 224):

| Маска | Двоичное представление (только последний октет)| Десятеричное представление |
| :- | :- | :- |
|/27|255.255.255.111 00000|255.255.255.224|
|/29|255.255.255.11111 000|255.255.255.248|
|/30|255.255.255.111111 00|255.255.255.252|

При настройке интерфейсов на роутерах так же используется маска /29, показанная в таблице.
Для настройки линка (подробнее: https://linkmeup.ru/blog/1191/ ```ctrl+f "мелкие сетки /30"```), то есть сети лишь с двумя адресами, используется маска /30. 
Такой линк настроен между Router2 и Router4 (10.0.0.0/30), а также между роутерами 0, 1, 2 и 3, соответствующие сети показаны на рисунке. 

На Router4 настроено два подинтерфейса для VLAN. Один VLAN используется для сервера, другой для компьютера.

# Настройка RIP и немного теории
**Routing Information Protocol**

- Данный протокол динамической маршрутизации относится к дистанционно-векторным протоколам (каждый маршрутизатор делится своей таблицей маршрутизации с соседями);
- Метрика - количество промежуточных устройств ("хопов").

Работает на основе трех таймеров:

> - Регулярной рассылки (полной таблицы маршрутизации соседям);
> - Timeout'a (запускается при появлении записи в таблице маршрутизации, сбрасывается при получении сообщения-подтверждения этой записи);
> - Сборщика мусора (запускается, когда Timeout-таймер для данной записи истёк; записи выставляется бесконечная метрика (16), на срок действия таймера маршрут считается недостижимым; если не приходит подтверждение, запись истекает и запись удаляется).

<table>
    <thead>
        <tr>
            <th>0 &nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp 7</th>
            <th>8 &nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp 15</th>
            <th>16 &nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp 31</th>
        </tr>
    </thead>
    <tbody>
        <tr>
            <td> &nbsp&nbspКоманда <br></br></td>
            <td> &nbsp&nbsp&nbspВерсия <br></br></td>
            <td colspan=2> &nbsp&nbspНе используется <br></br></td>
        </tr>
        <tr>
            <td colspan=2 align="center"> Идентификатор <br>адресного пространства</br></td>
            <td> Тэг маршрута (v2)<br></br></td>
        </tr>
        <tr>
            <td colspan=3 align="center">IP-адрес сети</td>
        </tr>
        <tr>
            <td colspan=3 align="center">Маска сети (v2)</td>
        </tr>
        <tr>
            <td colspan=3 align="center">Адрес следующего роутера (v2)</td>
        </tr>
        <tr>
            <td colspan=3 align="center">Метрика</td>
        </tr>
    </tbody>
</table>

**Команда** - по сути, тип сообщения, оно может быть либо запросом, либо ответом на запрос, либо сообщением регулярной рассылки.

**Идентификатор адресного пространства** - указывает тип адреса (IPv4).

**Тэг маршрута** - добавлено в v2 протокола, позволяет отличить внутренний (полученный по протоколу RIP) маршрут от внешнего (полученный от другого протокола, либо записанный статически или напрямую подключенный), что влияет на метрику.

**IP-адрес сети** - адрес сети назначения.

**Маска сети** - добавлено в v2 протокола, вносит поддержку бесклассовой (CIDR) адресации в протокол.

В ответе на запрос или в рассылке к заголовку прилагаются от 1 до 25 записей таблицы маршрутизации, записи добавляются в конец, каждая запись состоит из 5 строк (поля от идентификатора до метрики). В запросе присутствует только один вышеописанный заголовок.

Во второй версии протокола исправлены следующие недостатки первой версии:
- Широковещательная рассылка заменена на групповую;
- Отсуствие бесклассовой адресации.

Настройка данного протокола на роутерах 0, 1, 3 ограничена следующими командами:

`router rip` - начало настройки

`version 2` - обязательно выбрать версию с поддержкой бесклассовой адресации

`redistribute connected` - рассказывать соседям о своих напрямую подключенных сетях

`network 10.0.0.0` - запуск процесса RIP на интерфейсах с IP, попадающими в диапазон 10.0.0.0/8

`no auto-summary` - для передачи подсетей (отключение автоматического суммирования маршрутов)

На роутере 2 вдобавок необходимо ввести дополнительную команду:

`passive-interface se0/3/0` - отключение RIP на данном интерфейсе

# Сервер DHCP, DNS и почты
Сначала немного теории.

В протокол сетевого уровня IP, служащий для маршрутизации в сетях и между сетями, встраивается (инкапсулируется) полезная нагрузка какого-либо (TCP, UDP) протокола транспортного уровня. В заголовке такого протокола обязательно присутствуют поля "Порт источника" и "Порт получателя". Эти порты необходимы, чтобы передавать данные определенному системному процессу (приложению). Связку IP + порт так же иногда называют socket. 

**UDP - User Datagram Protocol (протокол пользовательских датаграмм)**

Протокол без установления соединения. Используется там, где не так важна целостность данных, как скорость их передачи (потоковое видео/аудио).
Его заголовок включает в себя также поля "Длина сегмента" и "Контрольная сумма".

<table>
    <thead>
        <tr>
            <th>0 &nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp 15</th>
            <th>16 &nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp 31</th>
        </tr>
    </thead>
    <tbody>
        <tr>
            <td> &nbsp Порт источника <br></br></td>
            <td> &nbsp Порт получателя <br></br></td>
        </tr>
        <tr>
            <td align="center"> Длина <br>сегмента</br></td>
            <td align="center"> Контрольная <br>сумма</br></td>
        </tr>
    </tbody>
</table>

**DHCP - Dynamic Host Control Protocol.** Работает поверх UDP (порт компьютера 68, порт сервера DHCP 67). Необходим для автоматической настройки IP-адресации на конечных устройствах. Для этого применяется процесс DORA:

1) **D - Discover**

Src. IP: 0.0.0.0

Dest. IP: 255.255.255.255

Конечное устройство отправляет на широковещательный адрес (255.255.255.255) DHCP-запрос с UDP-порта 68 на UDP-порт 67. В самом DHCP-заголовке присутствует поле "Код операции", если его значение = 1, это означает, что данный пакет является запросом устройства. На данном этапе в заголовке DHCP отсутствуют IP-адреса сервера DHCP и конечного устройства, всё, что есть - это MAC-адрес устройства.

2) **O - Offer**

Src. IP: <IP-адрес сервера>

Dest. IP: 255.255.255.255

Когда какой-нибудь DHCP-сервер в данной сети получает запрос и собирается назначить устройству IP-адрес, первым делом необходимо убедиться, что данный адрес отсутствует в сети. Для этого сервер генерирует ARP-запрос с данным адресом. Если он не получает ответ на этот запрос, то отправляет конечному устройству DHCP-Offer, в котором указана необходимая информация (DNS-сервер, адрес шлюза, а также адрес сервера, клиентский IP-адрес и клиентский MAC). 

3) **R - Request**

Src. IP: 0.0.0.0

Dest. IP: 255.255.255.255

Далее устройство подтверждает намерение получить данный IP-адрес, отправляя ещё одну датаграмму, аналогичную Discover, но с указанным IP-адресом клиента.

4) **A - Acknowledge**

Src. IP: <IP-адрес сервера>

Dest. IP: 255.255.255.255

Сервер подтверждает назначение IP датаграммой, аналогичной Offer.

В рамках данной топологии настроим раздачу IP-адресов в сети 192.168.1.64/27 для интерфейсов fa0/3-10 (8 интерфейсов), для этого необходимо на Switch3 у этих портов настроить метку VLAN 2:

```int range fa0/3-10

switchport mode access

switchport access vlan 2```

Теперь при подключении к этим портам компьютеры оказываются в VLAN 2 и могут использовать DHCP.

На сервере настраивается динамическое назначение статических адресов (без времени аренды). 

![DHCP](https://github.com/baltineu/telecom-labs/blob/main/cisco_pt/ccna_openedu/sources/lab5/3.PNG)

# Access lists (списки доступа)

# Дополнительное задание
